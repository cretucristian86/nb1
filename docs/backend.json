{
  "entities": {
    "KitRegistration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "KitRegistration",
      "type": "object",
      "description": "Represents a user's kit registration in the campaign.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the KitRegistration entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User. (Relationship: User 1:N KitRegistration)"
        },
        "name": {
          "type": "string",
          "description": "The registrant's first name."
        },
        "surname": {
          "type": "string",
          "description": "The registrant's last name."
        },
        "phone": {
          "type": "string",
          "description": "The registrant's phone number."
        },
        "address": {
          "type": "string",
          "description": "The registrant's address."
        },
        "kitSerialNumber": {
          "type": "string",
          "description": "The serial number of the kit associated with the registration."
        }
      },
      "required": [
        "userId",
        "name",
        "surname",
        "phone",
        "address",
        "kitSerialNumber"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.  Note: Authentication details (passwords, etc.) should be handled by Firebase Auth and NOT stored directly in this entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": {
        "$ref": "#/backend/entities/User"
      },
      "description": "Stores user profiles. Only the authenticated user can access their own profile.",
      "rules": {
        "read": "request.auth.uid == userId",
        "write": "request.auth.uid == userId"
      }
    },
    "/nb1-users/{document=**}": {
      "schema": {
        "$ref": "#/backend/entities/KitRegistration"
      },
      "description": "Stores kit registration data for all users. Each document contains a userId to link back to the user.",
       "rules": {
        "get": "request.auth.uid == resource.data.userId",
        "list": "request.auth != null && request.query.where.userId == request.auth.uid",
        "create": "request.auth != null && request.auth.uid == request.resource.data.userId",
        "update": "request.auth != null && request.auth.uid == resource.data.userId"
      }
    }
  }
}
